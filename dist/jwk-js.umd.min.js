!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("crypto")):"function"==typeof define&&define.amd?define(["exports","crypto"],e):e((t=t||self).jwkJs={},t.crypto)}(this,function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var r=function(){function t(t){this.buf=[+t||0]}return t.prototype.mulAdd=function(t,e){var r,n,i=this.buf,o=i.length;for(r=0;r<o;++r)(n=i[r]*t+e)<1e13?e=0:n-=1e13*(e=0|n/1e13),i[r]=n;e>0&&(i[r]=e)},t.prototype.sub=function(t){var e,r,n=this.buf,i=n.length;for(e=0;e<i;++e)(r=n[e]-t)<0?(r+=1e13,t=1):t=0,n[e]=r;for(;0===n[n.length-1];)n.pop()},t.prototype.toString=function(t){if(10!=(t||10))throw"only base 10 is supported";for(var e=this.buf,r=e[e.length-1].toString(),n=e.length-2;n>=0;--n)r+=(1e13+e[n]).toString().substring(1);return r},t.prototype.valueOf=function(){for(var t=this.buf,e=0,r=t.length-1;r>=0;--r)e=1e13*e+t[r];return e},t.prototype.simplify=function(){var t=this.buf;return 1==t.length?t[0]:this},t}(),n="Illegal argument specified!";function i(t,e){return t+("0"+e.toString(16)).slice(-2)}function o(t){return 0===t[0]?o(t.slice(1)):t}function u(t){if(!t)throw new Error(n);var e=t.match(/[0-9A-F]{2}/gi);if(!e)throw new Error(n);return new Uint8Array(e.map(function(t){return parseInt(t,16)}))}function s(t){try{return Promise.resolve(t())}catch(t){return Promise.reject(t)}}function a(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function c(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),String.fromCharCode.apply(String,t)}function f(t){try{if("object"==typeof window&&"function"==typeof window.atob)return window.atob(t);if("undefined"!=typeof Buffer)return Buffer.from(t,"base64").toString("binary");throw new Error(n)}catch(t){throw new Error(t)}}function h(t){if("string"!=typeof t||t.length%4!=0)throw new Error(n);return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function p(t){if("string"!=typeof t||t.length%4==1)throw new Error(n);for(;t.length%4!=0;)t+="=";return t.replace(/\-/g,"+").replace(/_/g,"/")}function g(t){return f(p(t))}function l(t){try{if("object"==typeof window&&"function"==typeof window.atob)return window.btoa(t);if("undefined"!=typeof Buffer)return Buffer.from(t).toString("base64");throw new Error(n)}catch(t){throw new Error(t)}}function d(t){return h(l(t))}var b="â€¦",v=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,y=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;function m(t,e){return t.length>e&&(t=t.substring(0,e)+b),t}var S=function(){function t(e,r){void 0===r&&(r=0),this.hexDigits="0123456789ABCDEF",e instanceof t?(this.enc=e.enc,this.pos=e.pos):(this.enc=e,this.pos=r)}return t.prototype.get=function(t){if(void 0===t&&(t=this.pos++),t>=this.enc.length)throw"Requesting byte offset "+t+" on a stream of length "+this.enc.length;return"string"==typeof this.enc?this.enc.charCodeAt(t):this.enc[t]},t.prototype.hexByte=function(t){return this.hexDigits.charAt(t>>4&15)+this.hexDigits.charAt(15&t)},t.prototype.hexDump=function(t,e,r){for(var n="",i=t;i<e;++i)if(n+=this.hexByte(this.get(i)),!0!==r)switch(15&i){case 7:n+="  ";break;case 15:n+="\n";break;default:n+=" "}return n},t.prototype.isASCII=function(t,e){for(var r=t;r<e;++r){var n=this.get(r);if(n<32||n>176)return!1}return!0},t.prototype.parseStringISO=function(t,e){for(var r="",n=t;n<e;++n)r+=String.fromCharCode(this.get(n));return r},t.prototype.parseStringUTF=function(t,e){for(var r="",n=t;n<e;){var i=this.get(n++);r+=i<128?String.fromCharCode(i):i>191&&i<224?String.fromCharCode((31&i)<<6|63&this.get(n++)):String.fromCharCode((15&i)<<12|(63&this.get(n++))<<6|63&this.get(n++))}return r},t.prototype.parseStringBMP=function(t,e){for(var r,n,i="",o=t;o<e;)r=this.get(o++),n=this.get(o++),i+=String.fromCharCode(r<<8|n);return i},t.prototype.parseTime=function(t,e,r){var n=this.parseStringISO(t,e),i=(r?v:y).exec(n);if(!i)return"Unrecognized time: "+n;if(r){var o=+i[1]<70?2e3:1900;i[1]=o+""}return n=i[1]+"-"+i[2]+"-"+i[3]+" "+i[4],i[5]&&(n+=":"+i[5],i[6]&&(n+=":"+i[6],i[7]&&(n+="."+i[7]))),i[8]&&(n+=" UTC","Z"!=i[8]&&(n+=i[8],i[9]&&(n+=":"+i[9]))),n},t.prototype.parseInteger=function(t,e){for(var n,i=this.get(t),o=i>127,u=o?255:0,s="";i==u&&++t<e;)i=this.get(t);if(0===(n=e-t))return o?-1:0;if(n>4){var a=+i;for(n<<=3;0==(128&(a^u));)a<<=1,--n;s="("+n+" bit)\n"}o&&(i-=256);for(var c=new r(i),f=t+1;f<e;++f)c.mulAdd(256,this.get(f));return s+c.toString()},t.prototype.parseBitString=function(t,e,r){for(var n=this.get(t),i="("+((e-t-1<<3)-n)+" bit)\n",o="",u=t+1;u<e;++u){for(var s=this.get(u),a=u==e-1?n:0,c=7;c>=a;--c)o+=s>>c&1?"1":"0";if(o.length>r)return i+m(o,r)}return i+o},t.prototype.parseOctetString=function(t,e,r){if(this.isASCII(t,e))return m(this.parseStringISO(t,e),r);var n=e-t,i="("+n+" byte)\n";n>(r/=2)&&(e=t+r);for(var o=t;o<e;++o)i+=this.hexByte(this.get(o));return n>r&&(i+=b),i},t.prototype.parseOID=function(t,e,n){for(var i="",o=new r,u=0,s=t;s<e;++s){var a=this.get(s);if(o.mulAdd(128,127&a),u+=7,!(128&a)){if(""===i)if((o=o.simplify())instanceof r)o.sub(80),i="2."+o.toString();else{var c=o<80?o<40?0:1:2;i=c+"."+(o-40*c)}else i+="."+o.toString();if(i.length>n)return m(i,n);o=new r,u=0}}return u>0&&(i+=".incomplete"),i},t}(),w=function(){function t(t,e,r,n,i){if(!(n instanceof E))throw"Invalid tag value.";this.stream=t,this.header=e,this.length=r,this.tag=n,this.sub=i}return t.decodeLength=function(t){var e=t.get(),r=127&e;if(r==e)return r;if(r>6)throw"Length over 48 bits not supported at position "+(t.pos-1);if(0===r)return null;e=0;for(var n=0;n<r;++n)e=256*e+t.get();return e},t.decode=function(e){e instanceof S||(e=new S(e,0));var r=new S(e),n=new E(e),i=t.decodeLength(e),o=null,u=e.pos,s=u-r.pos,a=function(){if(o=[],null!==i){for(var r=u+i;e.pos<r;)o[o.length]=t.decode(e);if(e.pos!=r)throw"Content size is not correct for container starting at offset "+u}else try{for(;;){var n=t.decode(e);if(n.tag.isEOC())break;o[o.length]=n}i=u-e.pos}catch(t){throw"Exception while decoding undefined length content: "+t}};if(n.tagConstructed)a();else if(n.isUniversal()&&(3==n.tagNumber||4==n.tagNumber))try{if(3==n.tagNumber&&0!=e.get())throw"BIT STRINGs with unused bits cannot encapsulate.";a();for(var c=0;c<o.length;++c)if(o[c].tag.isEOC())throw"EOC is not supposed to be actual content."}catch(t){o=null}if(null===o){if(null===i)throw"We can't skip over an invalid tag with undefined length at offset "+u;e.pos=u+Math.abs(i)}return new t(r,s,i,n,o)},t.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},t.prototype.content=function(t){if(void 0===this.tag)return null;void 0===t&&(t=1/0);var e=this.posContent(),r=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+r,t);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(e)?"false":"true";case 2:return this.stream.parseInteger(e,e+r);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(e,e+r,t);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+r,t);case 6:return this.stream.parseOID(e,e+r,t);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return m(this.stream.parseStringUTF(e,e+r),t);case 18:case 19:case 20:case 21:case 22:case 26:return m(this.stream.parseStringISO(e,e+r),t);case 30:return m(this.stream.parseStringBMP(e,e+r),t);case 23:case 24:return this.stream.parseTime(e,e+r,23==this.tag.tagNumber)}return null},t.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},t.prototype.posStart=function(){return this.stream.pos},t.prototype.posContent=function(){return this.stream.pos+this.header},t.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},t.prototype.toHexString=function(t){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},t.prototype.getHex=function(){return this.stream.hexDump(this.posContent(),this.posEnd(),!0)},t.prototype.getAB=function(t){return void 0===t&&(t=!0),t?o(u(this.getHex())):u(this.getHex())},t}(),E=function(){function t(t){var e=t.get();if(this.tagClass=e>>6,this.tagConstructed=0!=(32&e),this.tagNumber=31&e,31==this.tagNumber){var n=new r;do{e=t.get(),n.mulAdd(128,127&e)}while(128&e);this.tagNumber=n.simplify()}}return t.prototype.isUniversal=function(){return 0===this.tagClass},t.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},t}(),A=function(){return function(t){var e=this;if("string"!=typeof t)throw new Error(n);this.type="public";var r=t.split("\n"),i=["-BEGIN PRIVATE KEY-","-END PRIVATE KEY-","-BEGIN EC PRIVATE KEY-","-END EC PRIVATE KEY-","-BEGIN RSA PRIVATE KEY-","-END RSA PRIVATE KEY-"],o=["-BEGIN RSA PUBLIC KEY-","-BEGIN EC PUBLIC KEY-","-BEGIN PUBLIC KEY-","-END PUBLIC KEY-","-END EC PUBLIC KEY-","-END RSA PUBLIC KEY-"],u=r.map(function(t){return t.trim()}).filter(function(t){return t.length&&function(t){return i.some(function(e){return t.toUpperCase().indexOf(e)>-1})?(e.type="private",!1):!o.some(function(e){return t.toUpperCase().indexOf(e)>-1})}(t)}).join("");if(u.length)return this.body=a(f(p(u))),this;throw new Error(n)}}(),C=[{name:"p-256",curve:"1.2.840.10045.3.1.7",coordinateLength:32},{name:"p-384",curve:"1.3.132.0.34",coordinateLength:48},{name:"p-384",curve:"1.3.132.0.35",coordinateLength:66}],B=function(){function t(){}return t.ASN1fromPEM=function(t){if(!t)throw new Error(n);t instanceof ArrayBuffer&&(t=new Uint8Array(t));var e=w.decode(t),r={};return 3===e.sub.length?(r.version=e.sub[0].content(),r.keyType=e.sub[1].sub[0].content(),r.namedCurve=e.sub[1].sub[1].content(),r.versionSub=e.sub[2].sub[0].sub[0].content(),r.privateKey=e.sub[2].sub[0].sub[2].getAB(),r.curveTypeSub=e.sub[2].sub[0].sub[2].sub[0].content(),r.publicKey=e.sub[2].sub[0].sub[3].sub[0].getAB()):2===e.sub.length&&(r.keyType=e.sub[0].sub[0].content(),r.namedCurve=e.sub[0].sub[1].content(),r.publicKey=e.sub[1].getAB()),e},t.JWKfromASN1=function(t,e,r){if(!t)throw new Error(n);if("private"===(e="string"==typeof e&&e.toLowerCase()||["public","private"][t.privateKey?1:0])&&!t.privateKey)throw new Error(n);var i=C.find(function(e){return e.curve===t.namedCurve});if(!i)throw new Error(n);var o=t.publicKey;if(4!==o.readInt8(0))throw new Error(n);var u=Object.assign({kty:"EC",crv:i.name},r,{x:d(c(o.slice(1,i.coordinateLength))),y:d(c(o.slice(i.coordinateLength+1,2*(i.coordinateLength+1))))});return"private"===e&&Object.assign(u,{d:d(c(t.privateKey))}),u},t.JWKfromEC=function(e,r,n){return s(function(){var i=new A(e);return t.JWKfromASN1(t.ASN1fromPEM(i.body),r,n)})},t}();function N(t,e,r,n){return new(r||(r=Promise))(function(i,o){function u(t){try{a(n.next(t))}catch(t){o(t)}}function s(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(u,s)}a((n=n.apply(t,e||[])).next())})}function I(t,e){var r,n,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var x="object"==typeof window&&(window.crypto||window.msCrypto),P=x&&(x.subtle||x.webkitSubtle||x.Subtle),R=function(){function t(){}return t.createSigner=function(t,r){return N(this,void 0,void 0,function(){var n;return I(this,function(i){return P?(n=a(r),[2,P.importKey("raw",n,{name:"HMAC",hash:{name:t}},!0,["sign"]).then(function(t){return{update:function(e){return N(this,void 0,void 0,function(){return I(this,function(r){return[2,P.sign("HMAC",t,a(e))]})})}}})]):[2,e&&e.createHmac?Promise.resolve(e.createHmac(t.replace("SHA-","sha"),r)):Promise.reject(x)]})})},t.sign=function(e){return function(r,n){return N(this,void 0,void 0,function(){var i,o,u,s,a,f,p;return I(this,function(g){switch(g.label){case 0:return[4,t.createSigner("SHA-"+e,n)];case 1:return i=g.sent(),u=(o=Promise).resolve,P?(a=d,f=c,(p=i)?[4,i.update(r)]:[3,3]):[3,4];case 2:p=g.sent(),g.label=3;case 3:return s=a.apply(void 0,[f.apply(void 0,[p])]),[3,5];case 4:s=h(i&&i.update(r).digest("base64")),g.label=5;case 5:return[2,u.apply(o,[s])]}})})}},t.verify=function(e){return function(r,n,i){return N(this,void 0,void 0,function(){return I(this,function(o){switch(o.label){case 0:return[4,t.sign(e)(r,i)];case 1:return[2,o.sent()===n]}})})}},t}(),T="object"==typeof window&&(window.crypto||window.msCrypto),K=T&&(T.subtle||T.webkitSubtle||T.Subtle),U=function(){function t(){}return t.ASN1fromPEM=function(t){if(!t)throw new Error(n);t instanceof ArrayBuffer&&(t=new Uint8Array(t));var e=w.decode(t),r={};if(3===e.sub.length&&(e=e.sub[2].sub[0]),9===e.sub.length?(r.modulus=e.sub[1].getAB(),r.publicExponent=parseInt(e.sub[2].getHex(),16),r.privateExponent=e.sub[3].getAB(),r.prime1=e.sub[4].getAB(),r.prime2=e.sub[5].getAB(),r.exponent1=e.sub[6].getAB(),r.exponent2=e.sub[7].getAB(),r.coefficient=e.sub[8].getAB()):2===e.sub.length&&(e=e.sub[1].sub[0],r.modulus=e.sub[0].getAB(),r.publicExponent=parseInt(e.sub[1].getHex(),16)),r.bits=8*(r.modulus.length-1)+Math.ceil(Math.log(r.modulus[0]+1)/Math.log(2)),!r.bits)throw new Error(n);return r},t.JWKfromASN1=function(t,e,r){if(!t)throw new Error(n);if("private"===(e="string"==typeof e&&e.toLowerCase()||["public","private"][t.privateExponent?1:0])&&!t.privateExponent)throw new Error(n);var i=t.publicExponent,o=Math.ceil(Math.log(i)/Math.log(256)),u=new Uint8Array(o).map(function(t){return t=i%256,i=Math.floor(i/256),t}).reverse(),s=Object.assign({kty:"RSA"},r,{n:d(c(t.modulus)),e:d(c(u))});return"private"===e&&Object.assign(s,{d:d(c(t.privateExponent)),p:d(c(t.prime1)),q:d(c(t.prime2)),dp:d(c(t.exponent1)),dq:d(c(t.exponent2)),qi:d(c(t.coefficient))}),s},t.JWKfromRSA=function(e,r,n){return s(function(){var i=new A(e);return t.JWKfromASN1(t.ASN1fromPEM(i.body),r,n)})},t.createSigner=function(r){if(K)return{update:function(e){return{sign:function(n,i){return N(this,void 0,void 0,function(){var i=this;return I(this,function(o){return[2,t.JWKfromRSA(n,"private",{key_ops:["sign"],alg:r.replace("SHA-","RS")}).then(function(t){return N(i,void 0,void 0,function(){var n=this;return I(this,function(i){return[2,K.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:r}},!0,["sign"]).then(function(t){return N(n,void 0,void 0,function(){return I(this,function(n){return[2,K.sign({name:"RSASSA-PKCS1-v1_5",hash:{name:r}},t,a(e)).then(c).then(l)]})})})]})})})]})})}}}};if(e&&e.createSign)return e.createSign(r.replace("SHA-","RSA-SHA"));throw new Error(n)},t.sign=function(e){return function(r,n){return N(this,void 0,void 0,function(){return I(this,function(i){return[2,s(function(){return t.createSigner("SHA-"+e).then(function(t){return t.update(r).sign(n,"base64").then(h)})})]})})}},t.createVerifier=function(r){if(K)return{update:function(e){return{verify:function(n,i,o){return N(this,void 0,void 0,function(){var o=this;return I(this,function(u){return[2,t.JWKfromRSA(n,"public",{key_ops:["verify"],alg:r.replace("SHA-","RS")}).then(function(t){var n=t.kty,u=t.n,s=t.e;return N(o,void 0,void 0,function(){return I(this,function(t){return[2,K.importKey("jwk",{kty:n,n:u,e:s},{name:"RSASSA-PKCS1-v1_5",hash:{name:r}},!1,["verify"]).then(function(t){return K.verify("RSASSA-PKCS1-v1_5",t,a(g(i)),a(e))})]})})})]})})}}}};if(e&&e.createVerify)return e.createVerify(r.replace("SHA-","RSA-SHA"));throw new Error(n)},t.verify=function(e){return function(r,n,i){return N(this,void 0,void 0,function(){var o;return I(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,t.createVerifier("SHA-"+e).then(function(t){return t.update(r).verify(i,p(n),"base64")})];case 1:return[2,u.sent()];case 2:return o=u.sent(),[2,Promise.reject(new Error(o.message))];case 3:return[2]}})})}},t}(),O={ASN1:w,EC:B,PEM:A,RSA:U,HMAC:R,ILLEGAL_ARGUMENT:n,UNSUPPORTED_ALGORITHM:'Unsupported algorithm name specified! Supported algorithms: "HS256", "HS384", "HS512", "RS256", "RS384", "RS512" and "none".',tryPromise:s,AB2hex:function(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t.reduce(i,"")},AB2s:c,b2bu:h,b2s:f,bu2b:p,bu2s:g,cleanZeros:o,hex2AB:u,num2hex:i,s2AB:a,s2b:l,s2bu:d};t.default=O,Object.defineProperty(t,"__esModule",{value:!0})});
